var validaFormulario=function validaFormulario(){var cout_campos_invalidos=0;$(".required").each(function(){if(!this.value){$(this).parent().addClass('is-invalid');cout_campos_invalidos++}else{$(this).parent().removeClass('is-invalid')}});return cout_campos_invalidos===0?!0:!1}
var getPageName=function getPageName(){var url=document.location.href;url=url.substring(0,(url.indexOf("#")==-1)?url.length:url.indexOf("#"));url=url.substring(0,(url.indexOf("?")==-1)?url.length:url.indexOf("?"));url=url.substring(url.lastIndexOf("/")+1,url.length);return url}
var getParam=function getParam(param){var vars={};window.location.href.replace(location.hash,'').replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(m,key,value){vars[key]=value!==undefined?value:''});if(param){return vars[param]?vars[param]:null}
return vars}
var snackMessage=function snackMessage(obj,mensagem,tempo){var snackSettings={message:mensagem,timeout:tempo};var snackbarContainer=document.querySelector(obj);snackbarContainer.MaterialSnackbar.showSnackbar(snackSettings)}
var LoadingProgress={container:document.querySelector('#icon-loading'),show:function Show(){this.container.style.display='block'},hide:function Hide(){this.container.style.display='none'}}
var ativaBotao=function ativaBotao(botao){document.querySelector(botao).disabled=!1}
var desativaBotao=function desativaBotao(botao){document.querySelector(botao).disabled=!0}
var setToken=function setToken(token){clearToken();window.localStorage.setItem('token',token);setInfosUser()}
var getToken=function getToken(){var token=window.localStorage.getItem('token');return token}
var validaToken=function validaToken(token){if(typeof token==='string'){var tokenLocal=getToken();return tokenLocal===token?!0:!1}
return!1}
var decodeToken=function decodeToken(){var tokenLocal=getToken();var tokenDecoded=jwt_decode(tokenLocal);return tokenDecoded}
var clearToken=function clearToken(){window.localStorage.removeItem('token');window.localStorage.removeItem('userId');window.localStorage.removeItem('userNome');window.localStorage.removeItem('userEmail');window.localStorage.removeItem('userTipo')}
var setInfosUser=function setInfosUser(){var objUserInfos=decodeToken();window.localStorage.setItem('userId',objUserInfos.id_colaborador);window.localStorage.setItem('userNome',objUserInfos.nome);window.localStorage.setItem('userEmail',objUserInfos.email);window.localStorage.setItem('userTipo',objUserInfos.permissao)}
var getUserId=function getUserId(){return window.localStorage.getItem('userId')}
var getUserNome=function getUserNome(){return window.localStorage.getItem('userNome')}
var getUserEmail=function getUserEmail(){return window.localStorage.getItem('userEmail')}
var getUserTipo=function getUserTipo(){return window.localStorage.getItem('userTipo')}
var loadPermissoes=function loadPermissoes(){$('#user-name-sidebar').text(getUserNome());if(getUserTipo()!=='ADMINISTRADOR'){$('.restrito-admin').remove()}}
var permissaoPage=function permissaoPage(pagina){var permissaoPage=!1;var pags_admin=['index.html','respostas.html','cadastrar_resposta.html','editar_resposta.html','colaboradores.html','cadastrar_colaborador.html','editar_colaborador.html','atividades.html','cadastrar_atividade.html','editar_atividade.html','editar_endereco.html','curadoria.html','curadoria_revisao.html','curadoria_reprovacao.html','filme_curadoria.html','monitoria.html','filme_monitoria.html','monitoria_revisao.html','monitoria_reprovacao.html','minha_escala.html','escala.html'];var pags_user=['index.html','curadoria.html','curadoria_revisao.html','curadoria_reprovacao.html','filme_curadoria.html','monitoria.html','filme_monitoria.html','monitoria_revisao.html','monitoria_reprovacao.html','minha_escala.html'];var tipoUser=getUserTipo();if(tipoUser==='ADMINISTRADOR'){permissaoPage=pags_admin.some(function(pag){return pag===pagina})}else{permissaoPage=pags_user.some(function(pag){return pag===pagina})}
if(!permissaoPage){window.location.href='error_403.html'}}
var setMessageRetorno=function setMessageRetorno(msg){if(msg){window.localStorage.setItem('msg',msg)}}
var showMessageRetorno=function showMessageRetorno(){if(window.localStorage.getItem('msg')){snackMessage('#snackbar',window.localStorage.getItem('msg'),3000);window.localStorage.removeItem('msg')}}
$(document).ready(function(){setTimeout(function(){showMessageRetorno()},100)});var verificaLogin=function verificaLogin(){if(!getToken()){if(getPageName()!=='index.html'){window.location.href='index.html'}}
else{if(getPageName()==='index.html'){window.location.href='curadoria.html'}
loadPermissoes();permissaoPage(getPageName())}}
$(document).ready(function(){verificaLogin()});var efetuarLogout=function efetuarLogout(){clearToken();window.location.href='index.html'}
var btnLogout=$('#btn-logout');btnLogout.on('click',function(){efetuarLogout()});var efetuarLogin=function efetuarLogin(email,senha){var dados_login={email:email,senha:senha}
$.ajax({url:'http://localhost/Prj_StayFilm/login',type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados_login)}).done(function(response){setToken(response.token);ativaBotao('#btn-entrar');LoadingProgress.hide();verificaLogin()}).fail(function(response){if(response.readyState==4){if(response.status==401){snackMessage('#snackbar','Dados de acesso inválidos!',3000);ativaBotao('#btn-entrar');LoadingProgress.hide();$('#senha').val('');$('#senha').focus()}}
else if(response.readyState==0){snackMessage('#snackbar','Não foi possível realizar essa operação',3000);ativaBotao('#btn-entrar');LoadingProgress.hide();$('#senha').val('');$('#senha').focus()}
else{console.log('erro other...')}})}
$("#form-login").on('submit',function(e){e.preventDefault();desativaBotao('#btn-entrar');LoadingProgress.show();if(validaFormulario()){var email=$('#email').val();var senha=$('#senha').val();efetuarLogin(email,senha)}else{ativaBotao('#btn-entrar');LoadingProgress.hide()}});var listarRespostas=function listarRespostas(){$.ajax({url:'http://localhost/Prj_StayFilm/respostas',type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(itens){if(itens.length>0){var tbodyDOM=document.querySelector('#carrega-lista');tbodyDOM.innerHTML='';itens.forEach(function(item){var trDOM=document.createElement('tr');var td1DOM=document.createElement('td');trDOM.appendChild(td1DOM);var td2DOM=document.createElement('td');td2DOM.innerHTML=item.tituloResposta;trDOM.appendChild(td2DOM);var td3DOM=document.createElement('td');td3DOM.setAttribute('class','visible_desktop');td3DOM.innerHTML=item.respostaBRA;trDOM.appendChild(td3DOM);var td4DOM=document.createElement('td');var btnOptDOM=document.createElement('button');btnOptDOM.setAttribute('class','btn-menu mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon');btnOptDOM.setAttribute('id','item_'+item.idResposta);var iconBtnOptDOM=document.createElement('i');iconBtnOptDOM.setAttribute('class','material-icons');iconBtnOptDOM.setAttribute('role','presentation');iconBtnOptDOM.innerHTML='keyboard_arrow_down';btnOptDOM.appendChild(iconBtnOptDOM);td4DOM.appendChild(btnOptDOM);var ulOptsDOM=document.createElement('ul');ulOptsDOM.setAttribute('class','mdl-menu-item mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right');ulOptsDOM.setAttribute('for','item_'+item.idResposta);var aOptEditDOM=document.createElement('a');aOptEditDOM.setAttribute('class','link_item');aOptEditDOM.setAttribute('href','editar_resposta.html?id='+item.idResposta);var liOptEditDOM=document.createElement('li');liOptEditDOM.setAttribute('class','mdl-menu__item');var iconOptEditDOM=document.createElement('i');iconOptEditDOM.setAttribute('class','material-icons');iconOptEditDOM.setAttribute('role','presentation');iconOptEditDOM.innerHTML='edit';var txtIconOptEditDOM=document.createElement('span');txtIconOptEditDOM.innerHTML='Editar';liOptEditDOM.appendChild(iconOptEditDOM);liOptEditDOM.appendChild(txtIconOptEditDOM);aOptEditDOM.appendChild(liOptEditDOM);ulOptsDOM.appendChild(aOptEditDOM);var aOptDelDOM=document.createElement('a');aOptDelDOM.setAttribute('class','link_item remove-item');aOptDelDOM.addEventListener('click',function(){$('#id-item-remove').val(item.idResposta);$.featherlight('#lightbox_remover')});var liOptDelDOM=document.createElement('li');liOptDelDOM.setAttribute('class','mdl-menu__item');var iconOptDelDOM=document.createElement('i');iconOptDelDOM.setAttribute('class','material-icons');iconOptDelDOM.setAttribute('role','presentation');iconOptDelDOM.innerHTML='delete';var txtIconOptDelDOM=document.createElement('span');txtIconOptDelDOM.innerHTML='Remover';liOptDelDOM.appendChild(iconOptDelDOM);liOptDelDOM.appendChild(txtIconOptDelDOM);aOptDelDOM.appendChild(liOptDelDOM);ulOptsDOM.appendChild(aOptDelDOM);td4DOM.appendChild(ulOptsDOM);trDOM.appendChild(td4DOM);tbodyDOM.appendChild(trDOM);componentHandler.upgradeDom()})}
else{$('#table').hide();$('.sem-registros').show()}}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
$(document).ready(function(){if(getPageName()==='respostas.html'){listarRespostas()}});var insereResposta=function insereResposta(titulo,respostaBRA,respostaUSA,respostaESP){var dados={tituloResposta:titulo,respostaBRA:respostaBRA,respostaUSA:respostaUSA,respostaESP:respostaESP}
$.ajax({url:'http://localhost/Prj_StayFilm/private/resposta',type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Cadastrado com sucesso');window.location.href='respostas.html'}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var removeResposta=function removeResposta(idResposta){$.ajax({url:'http://localhost/Prj_StayFilm/private/resposta/remove/'+idResposta,type:'DELETE',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){snackMessage('#snackbar','Removido com sucesso',3000);listarRespostas()}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
$(document).ready(function(){$('#btn-modal-remover-resposta').on('click',function(del){removeResposta($('#id-item-remove').val())})});var updateResposta=function updateResposta(idResposta,tituloResposta,respostaBRA,respostaUSA,respostaESP){var dados={idResposta:idResposta,tituloResposta:tituloResposta,respostaBRA:respostaBRA,respostaUSA:respostaUSA,respostaESP:respostaESP}
$.ajax({url:'http://localhost/Prj_StayFilm/private/resposta/editar/'+idResposta,type:'PUT',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Alterado com sucesso');window.location.href='respostas.html'}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var getResposta=function getResposta(id){$.ajax({url:'http://localhost/Prj_StayFilm/resposta/'+id,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){$('#id_edit').val(response.idResposta).parent().addClass('is-dirty');$('#tituloResposta').val(response.tituloResposta).parent().addClass('is-dirty');$('#respostaBRA').val(response.respostaBRA).parent().addClass('is-dirty');$('#respostaUSA').val(response.respostaUSA).parent().addClass('is-dirty');$('#respostaESP').val(response.respostaESP).parent().addClass('is-dirty')}).fail(function(response){console.log(response);setMessageRetorno('Não foi possível realizar essa operação');window.location.href='respostas.html'})}
$(document).ready(function(){if(getPageName()==='editar_resposta.html'){var id=getParam('id');if(id){getResposta(id)}
else{window.location.href='respostas.html'}}});$("#form-cad-resposta").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var titulo=$('#tituloResposta').val();var respostaBRA=$('#respostaBRA').val();var respostaUSA=$('#respostaUSA').val();var respostaESP=$('#respostaESP').val();insereResposta(titulo,respostaBRA,respostaUSA,respostaESP)}else{$('#btn-submit').show();LoadingProgress.hide()}});$("#form-edit-resposta").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var idResposta=$('#id_edit').val();var tituloResposta=$('#tituloResposta').val();var respostaBRA=$('#respostaBRA').val();var respostaUSA=$('#respostaUSA').val();var respostaESP=$('#respostaESP').val();updateResposta(idResposta,tituloResposta,respostaBRA,respostaUSA,respostaESP)}else{$('#btn-submit').show();LoadingProgress.hide()}});var formatDataSQL=function formatDataSQL(data){var dataSplit=data.split('/');return dataSplit[2]+'-'+dataSplit[1]+'-'+dataSplit[0]}
var formatDataBR=function formatDataBR(data){var dataSplit=data.split('-');return dataSplit[2]+'/'+dataSplit[1]+'/'+dataSplit[0]}
var listarColaboradores=function listarColaboradores(){$.ajax({url:'http://localhost/Prj_StayFilm/listarColaboradores',type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(itens){if(itens.length>0){var tbodyDOM=document.querySelector('#carrega-lista');tbodyDOM.innerHTML='';itens.forEach(function(item){var trDOM=document.createElement('tr');var td1DOM=document.createElement('td');var spanStatus=document.createElement('span');if(item.status===!0){spanStatus.setAttribute('class','span_status aprovado');spanStatus.innerHTML='Ativo'}else{spanStatus.setAttribute('class','span_status reprovado');spanStatus.innerHTML='Inativo'}
td1DOM.appendChild(spanStatus);trDOM.appendChild(td1DOM);var td2DOM=document.createElement('td');td2DOM.innerHTML=item.nome;trDOM.appendChild(td2DOM);var td3DOM=document.createElement('td');td3DOM.innerHTML=item.email;trDOM.appendChild(td3DOM);var td4DOM=document.createElement('td');td4DOM.innerHTML=item.telefoneResidencial;trDOM.appendChild(td4DOM);var td5DOM=document.createElement('td');var btnOptDOM=document.createElement('button');btnOptDOM.setAttribute('class','btn-menu mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon');btnOptDOM.setAttribute('id','item_'+item.idColaborador);var iconBtnOptDOM=document.createElement('i');iconBtnOptDOM.setAttribute('class','material-icons');iconBtnOptDOM.setAttribute('role','presentation');iconBtnOptDOM.innerHTML='keyboard_arrow_down';btnOptDOM.appendChild(iconBtnOptDOM);td5DOM.appendChild(btnOptDOM);var ulOptsDOM=document.createElement('ul');ulOptsDOM.setAttribute('class','mdl-menu-item mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right');ulOptsDOM.setAttribute('for','item_'+item.idColaborador);var aOptEditDOM=document.createElement('a');aOptEditDOM.setAttribute('class','link_item');aOptEditDOM.setAttribute('href','editar_colaborador.html?id='+item.idColaborador);var liOptEditDOM=document.createElement('li');liOptEditDOM.setAttribute('class','mdl-menu__item');var iconOptEditDOM=document.createElement('i');iconOptEditDOM.setAttribute('class','material-icons');iconOptEditDOM.setAttribute('role','presentation');iconOptEditDOM.innerHTML='edit';var txtIconOptEditDOM=document.createElement('span');txtIconOptEditDOM.innerHTML='Editar';liOptEditDOM.appendChild(iconOptEditDOM);liOptEditDOM.appendChild(txtIconOptEditDOM);aOptEditDOM.appendChild(liOptEditDOM);ulOptsDOM.appendChild(aOptEditDOM);var aOptAtivDOM=document.createElement('a');aOptAtivDOM.setAttribute('class','link_item');aOptAtivDOM.setAttribute('href','atividades.html?id='+item.idColaborador);var liOptAtivDOM=document.createElement('li');liOptAtivDOM.setAttribute('class','mdl-menu__item');var iconOptAtivDOM=document.createElement('i');iconOptAtivDOM.setAttribute('class','material-icons');iconOptAtivDOM.setAttribute('role','presentation');iconOptAtivDOM.innerHTML='school';var txtIconOptAtivDOM=document.createElement('span');txtIconOptAtivDOM.innerHTML='Atividades';liOptAtivDOM.appendChild(iconOptAtivDOM);liOptAtivDOM.appendChild(txtIconOptAtivDOM);aOptAtivDOM.appendChild(liOptAtivDOM);ulOptsDOM.appendChild(aOptAtivDOM);var aOptEndDOM=document.createElement('a');aOptEndDOM.setAttribute('class','link_item');aOptEndDOM.setAttribute('href','editar_endereco.html?id='+item.idColaborador);var liOptEndDOM=document.createElement('li');liOptEndDOM.setAttribute('class','mdl-menu__item');var iconOptEndDOM=document.createElement('i');iconOptEndDOM.setAttribute('class','material-icons');iconOptEndDOM.setAttribute('role','presentation');iconOptEndDOM.innerHTML='location_on';var txtIconOptEndDOM=document.createElement('span');txtIconOptEndDOM.innerHTML='Endereço';liOptEndDOM.appendChild(iconOptEndDOM);liOptEndDOM.appendChild(txtIconOptEndDOM);aOptEndDOM.appendChild(liOptEndDOM);ulOptsDOM.appendChild(aOptEndDOM);td5DOM.appendChild(ulOptsDOM);trDOM.appendChild(td5DOM);tbodyDOM.appendChild(trDOM);componentHandler.upgradeDom()})}
else{$('#table').hide();$('.sem-registros').show()}}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
$(document).ready(function(){if(getPageName()==='colaboradores.html'){listarColaboradores()}});var insereColaborador=function insereColaborador(nome,nascimento,telefone,celular,email,senha,permissao,status){var dados={nome:nome,dataNasc:nascimento,status:status,telefoneResidencial:telefone,telefoneCelular:celular,email:email,senha:senha,permissao:permissao}
console.log(dados);$.ajax({url:'http://localhost/Prj_StayFilm/private/colaborador',type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Cadastrado com sucesso');window.location.href='colaboradores.html'}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var updateColaborador=function updateColaborador(idColaborador,nome,nascimento,telefone,celular,email,permissao,status,senha){var dados={idColaborador:idColaborador,nome:nome,dataNasc:nascimento,status:status,telefoneResidencial:telefone,telefoneCelular:celular,email:email,senha:senha,permissao:permissao}
console.log(dados);$.ajax({url:'http://localhost/Prj_StayFilm/colaborador/editar/'+idColaborador,type:'PATCH',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Alterado com sucesso');window.location.href='colaboradores.html'}).fail(function(response){if(response.status==200){setMessageRetorno('Alterado com sucesso');window.location.href='colaboradores.html'}else{console.log(response.status);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()}})}
var getColaborador=function getColaborador(id){$.ajax({url:'http://localhost/Prj_StayFilm/private/colaborador/busca/'+id,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){switch(getPageName()){case 'editar_colaborador.html':$('#id_edit').val(response.idColaborador);$('#nome').val(response.nome).parent().addClass('is-dirty');$('#nascimento').val(response.dataNasc.replace(/-/g,'/')).parent().addClass('is-dirty');$('#telefone').val(response.telefoneResidencial).parent().addClass('is-dirty');$('#celular').val(response.telefoneCelular).parent().addClass('is-dirty');$('#email').val(response.email).parent().addClass('is-dirty');response.permissao==='ADMINISTRADOR'?$('#permissao').val('Administrador').parent().addClass('is-dirty'):$('#permissao').val('Usuário Comum').parent().addClass('is-dirty');!!response.status?$('#status').val('Ativo').parent().addClass('is-dirty'):$('#status').val('Inativo').parent().addClass('is-dirty');break;case 'atividades.html':$('#titulo-nome-colaborador').text(response.nome);$('#btn-cad-atividade').attr('href','cadastrar_atividade.html?id='+response.idColaborador);listarAtividades(response.idColaborador);break;case 'cadastrar_atividade.html':case 'editar_atividade.html':$('#titulo-nome-colaborador').text(response.nome);$('#id_colaborador').val(response.idColaborador);$('#btn-cancelar-form-atividades').attr('href','atividades.html?id='+response.idColaborador);break;case 'editar_endereco.html':$('#titulo-nome-colaborador').text(response.nome);$('#id_colaborador').val(response.idColaborador);$('#btn-cancelar-form-atividades').attr('href','colaboradores.html');break}}).fail(function(response){console.log(response);setMessageRetorno('Não foi possível realizar essa operação');window.location.href='colaboradores.html'})}
$(document).ready(function(){if(getPageName()==='editar_colaborador.html'){var id=getParam('id');if(id){getColaborador(id)}
else{window.location.href='colaboradores.html'}}});$(document).ready(function(){if(getPageName()==='cadastrar_colaborador.html'||getPageName()==='editar_colaborador.html'){$("#nascimento").mask("99/99/9999",{placeholder:"dd/mm/yyyy"});$("#telefone").mask("(99) 9999-9999");$("#celular").mask("(99) 99999-9999");$("#nascimento, #telefone, #celular").on('change',function(){if($(this).val()){$(this).parent().addClass('is-dirty')}else{$(this).parent().removeClass('is-dirty')}});$("#email").on('change',function(){console.log('verificar email')});$("#senha2").on('change',function(){if($(this).val()!=$('#senha').val()){$(this).parent().addClass('is-invalid');$(this).val('')}else{$(this).parent().removeClass('is-invalid')}})}});$("#form-cad-colaborador").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var nome=$('#nome').val();var nascimento=formatDataSQL($('#nascimento').val());var telefone=$('#telefone').val();var celular=$('#celular').val();var email=$('#email').val();var senha=$('#senha').val();var permissao=$('#permissao').val()==='Administrador'?1:0;var status=$('#status').val()==='Ativo'?!0:!1;insereColaborador(nome,nascimento,telefone,celular,email,senha,permissao,status)}else{$('#btn-submit').show();LoadingProgress.hide()}});$("#form-edit-colaborador").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var idColaborador=$('#id_edit').val();var nome=$('#nome').val();var nascimento=formatDataSQL($('#nascimento').val());var telefone=$('#telefone').val();var celular=$('#celular').val();var email=$('#email').val();var senha=$('#senha').val();var permissao=$('#permissao').val()==='Administrador'?1:0;var status=$('#status').val()==='Ativo'?!0:!1;updateColaborador(idColaborador,nome,nascimento,telefone,celular,email,permissao,status,senha)}else{$('#btn-submit').show();LoadingProgress.hide()}});var listarAtividades=function listarAtividades(idColaborador){$.ajax({url:'http://localhost/Prj_StayFilm/lista/'+idColaborador,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(itens){if(itens.length>0){var tbodyDOM=document.querySelector('#carrega-lista');tbodyDOM.innerHTML='';itens.forEach(function(item){var trDOM=document.createElement('tr');var td1DOM=document.createElement('td');trDOM.appendChild(td1DOM);var td2DOM=document.createElement('td');td2DOM.innerHTML=item.atividade;trDOM.appendChild(td2DOM);var td3DOM=document.createElement('td');td3DOM.innerHTML=item.instituicao;trDOM.appendChild(td3DOM);var td4DOM=document.createElement('td');td4DOM.innerHTML=item.periodo;trDOM.appendChild(td4DOM);var td5DOM=document.createElement('td');var btnOptDOM=document.createElement('button');btnOptDOM.setAttribute('class','btn-menu mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon');btnOptDOM.setAttribute('id','item_'+item.idAtividade);var iconBtnOptDOM=document.createElement('i');iconBtnOptDOM.setAttribute('class','material-icons');iconBtnOptDOM.setAttribute('role','presentation');iconBtnOptDOM.innerHTML='keyboard_arrow_down';btnOptDOM.appendChild(iconBtnOptDOM);td5DOM.appendChild(btnOptDOM);var ulOptsDOM=document.createElement('ul');ulOptsDOM.setAttribute('class','mdl-menu-item mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right');ulOptsDOM.setAttribute('for','item_'+item.idAtividade);var aOptDelDOM=document.createElement('a');aOptDelDOM.setAttribute('class','link_item remove-item');aOptDelDOM.addEventListener('click',function(){$('#id-item-remove').val(item.idAtividade);$('#id-item-colaborador').val(idColaborador);$.featherlight('#lightbox_remover')});var liOptDelDOM=document.createElement('li');liOptDelDOM.setAttribute('class','mdl-menu__item');var iconOptDelDOM=document.createElement('i');iconOptDelDOM.setAttribute('class','material-icons');iconOptDelDOM.setAttribute('role','presentation');iconOptDelDOM.innerHTML='delete';var txtIconOptDelDOM=document.createElement('span');txtIconOptDelDOM.innerHTML='Remover';liOptDelDOM.appendChild(iconOptDelDOM);liOptDelDOM.appendChild(txtIconOptDelDOM);aOptDelDOM.appendChild(liOptDelDOM);ulOptsDOM.appendChild(aOptDelDOM);td5DOM.appendChild(ulOptsDOM);trDOM.appendChild(td5DOM);tbodyDOM.appendChild(trDOM);componentHandler.upgradeDom()})}
else{$('#table').hide();$('.sem-registros').show()}}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
var insereAtividade=function insereAtividade(idColaborador,instituicao,atividade,periodo,escalasFixas){var dados={instituicao:instituicao,atividade:atividade,periodo:periodo}
var insereEscalaFixa=function insereEscalaFixa(idColaborador,escala){$.ajax({url:'http://localhost/Prj_StayFilm/escalabloqueiofixo/'+idColaborador,type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(escala),headers:{'Authorization':getToken()}}).done(function(response){console.log('escala inserida com sucesso')}).fail(function(response){console.log('erro ao inserir escala')})}
$.ajax({url:'http://localhost/Prj_StayFilm/atividade/'+idColaborador,type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){escalasFixas.forEach(function(escala){insereEscalaFixa(idColaborador,escala)});setMessageRetorno('Cadastrado com sucesso');window.location.href='atividades.html?id='+idColaborador}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var updateAtividade=function updateAtividade(idColaborador,idAtividade,instituicao,atividade,periodo){var dados={idAtividade:idAtividade,instituicao:instituicao,atividade:atividade,periodo:periodo}
$.ajax({url:'http://localhost/Prj_StayFilm/atividade/editar/'+idAtividade+'/'+idColaborador,type:'PUT',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Alterado com sucesso');window.location.href='atividades.html?id='+idColaborador}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var removeAtividade=function removeAtividade(idColaborador,idAtividade){$.ajax({url:'http://localhost/Prj_StayFilm/atividade/'+idAtividade,type:'DELETE',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){snackMessage('#snackbar','Removido com sucesso',3000);listarAtividades(idColaborador)}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
var getAtividade=function getAtividade(id){$.ajax({url:'http://localhost/Prj_StayFilm/atividade/busca/'+id,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){$('#id_edit').val(response.idAtividade).parent().addClass('is-dirty');$('#instituicao').val(response.instituicao).parent().addClass('is-dirty');$('#atividade').val(response.atividade).parent().addClass('is-dirty');switch(response.periodo){case 'MANHA':$('#periodo').val('Manhã').parent().addClass('is-dirty');break;case 'TARDE':$('#periodo').val('Tarde').parent().addClass('is-dirty');break;case 'NOITE':$('#periodo').val('Noite').parent().addClass('is-dirty');break}}).fail(function(response){console.log(response);setMessageRetorno('Não foi possível realizar essa operação')})}
$("#form-cad-atividade").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var idColaborador=$('#id_colaborador').val();var instituicao=$('#instituicao').val();var atividade=$('#atividade').val();var periodo;switch($('#periodo').val()){case 'Manhã':periodo='MANHA';break;case 'Tarde':periodo='TARDE';break;case 'Noite':periodo='NOITE';break}
var escalasFixas=[];$('input[name="dias_semana"]:checked').each(function(){horarios=$('#horario_'+this.value).val().replace(/h|\s*/ig,'').split('às');escalasFixas.push({"diaSemana":this.value.toUpperCase(),"horaInicio":horarios[0].replace(/^0+/,''),"horaFim":horarios[1].replace(/^0+/,''),"colaboradorId":idColaborador})});insereAtividade(idColaborador,instituicao,atividade,periodo,escalasFixas)}else{$('#btn-submit').show();LoadingProgress.hide()}});$("#form-edit-atividade").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var idAtividade=$('#id_edit').val();var idColaborador=$('#id_colaborador').val();var instituicao=$('#instituicao').val();var atividade=$('#atividade').val();var periodo;switch($('#periodo').val()){case 'Manhã':periodo='MANHA';break;case 'Tarde':periodo='TARDE';break;case 'Noite':periodo='NOITE';break}
updateAtividade(idColaborador,idAtividade,instituicao,atividade,periodo)}else{$('#btn-submit').show();LoadingProgress.hide()}});$(document).ready(function(){$('#btn-modal-remover-atividade').on('click',function(del){removeAtividade($('#id-item-colaborador').val(),$('#id-item-remove').val())})});$(document).ready(function(){if(getPageName()==='atividades.html'||getPageName()==='cadastrar_atividade.html'||getPageName()==='editar_atividade.html'||getPageName()==='editar_endereco.html'){if(getPageName()==='cadastrar_atividade.html'){$(".horario_semana").mask("99h às 99h");$('.mdl-textfield__input').on('change',function(){if($(this).val()){$(this).parent().addClass('is-dirty')}})}
var id=getParam('id');if(id){getColaborador(id)}
else{window.location.href='colaboradores.html'}}});$(document).ready(function(){if(getPageName()==='editar_atividade.html'){var id=getParam('id');var id_atividade=getParam('id_atividade');if(id&&id_atividade){getAtividade(id)}
else{window.location.href='atividades.html?id='+id}}});var estados_nomes=[];estados_nomes.AC='Acre';estados_nomes.AL='Alagoas';estados_nomes.AP='Amapá';estados_nomes.AM='Amazonas';estados_nomes.BA='Bahia';estados_nomes.CE='Ceará';estados_nomes.DF='Distrito Federal';estados_nomes.ES='Espírito Santo';estados_nomes.GO='Goiás';estados_nomes.MA='Maranhão';estados_nomes.MT='Mato Grosso';estados_nomes.MS='Mato Grosso do Sul';estados_nomes.MG='Minas Gerais';estados_nomes.PA='Pará';estados_nomes.PB='Paraíba';estados_nomes.PR='Paraná';estados_nomes.PE='Pernambuco';estados_nomes.PI='Piauí';estados_nomes.RJ='Rio de Janeiro';estados_nomes.RN='Rio Grande do Norte';estados_nomes.RS='Rio Grande do Sul';estados_nomes.RO='Rondônia';estados_nomes.RR='Roraima';estados_nomes.SC='Santa Catarina';estados_nomes.SP='São Paulo';estados_nomes.SE='Sergipe';estados_nomes.TO='Tocantins';var estados_siglas=[];estados_siglas.Acre='AC';estados_siglas.Alagoas='AL';estados_siglas.Amapá='AP';estados_siglas.Amazonas='AM';estados_siglas.Bahia='BA';estados_siglas.Ceará='CE';estados_siglas['Distrito Federal']='DF';estados_siglas['Espírito Santo']='ES';estados_siglas.Goiás='GO';estados_siglas.Maranhão='MA';estados_siglas['Mato Grosso']='MT';estados_siglas['Mato Grosso do Sul']='MS';estados_siglas['Minas Gerais']='MG';estados_siglas.Pará='PA';estados_siglas.Paraíba='PB';estados_siglas.Paraná='PR';estados_siglas.Pernambuco='PE';estados_siglas.Piauí='PI';estados_siglas['Rio de Janeiro']='RJ';estados_siglas['Rio Grande do Norte']='RN';estados_siglas['Rio Grande do Sul']='RS';estados_siglas.Rondônia='RO';estados_siglas.Roraima='RR';estados_siglas['Santa Catarina']='SC';estados_siglas['São Paulo']='SP';estados_siglas.Sergipe='SE';estados_siglas.Tocantins='TO';var insereEndereco=function insereEndereco(idColaborador,endereco,complemento,bairro,cidade,estado,cep){var dados={endereco:endereco,complemento:complemento,bairro:bairro,cidade:cidade,estado:estado,cep:cep}
$.ajax({url:'http://localhost/Prj_StayFilm/endereco/'+idColaborador,type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Cadastrado com sucesso');window.location;href='colaboradores.html'}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var updateEndereco=function updateEndereco(idEndereco,idColaborador,endereco,complemento,bairro,cidade,estado,cep){var dados={idEndereco:idEndereco,endereco:endereco,complemento:complemento,bairro:bairro,cidade:cidade,estado:estado,cep:cep}
$.ajax({url:'http://localhost/Prj_StayFilm/endereco/editar/'+idEndereco+'/'+idColaborador,type:'PUT',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){setMessageRetorno('Alterado com sucesso');window.location.href='colaboradores.html'}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000);$('#btn-submit').show();LoadingProgress.hide()})}
var getEndereco=function getEndereco(idColaborador){$.ajax({url:'http://localhost/Prj_StayFilm/buscarEndereco/'+idColaborador,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){$('#acao').val('update');$('#btn-submit').val('Atualizar');$('#id_edit').val(response.idEndereco).parent().addClass('is-dirty');$('#id_colaborador').val(response.idColaborador.idColaborador).parent().addClass('is-dirty');$('#bairro').val(response.bairro).parent().addClass('is-dirty');$('#cep').val(response.cep).parent().addClass('is-dirty');$('#cidade').val(response.cidade).parent().addClass('is-dirty');$('#complemento').val(response.complemento).parent().addClass('is-dirty');$('#endereco').val(response.endereco).parent().addClass('is-dirty');$('#estado').val(estados_nomes[response.estado]).parent().addClass('is-dirty')}).fail(function(response){$('#acao').val('insert');$('#btn-submit').val('Cadastrar');console.log(response)})}
$("#form-endereco").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();LoadingProgress.show();if(validaFormulario()){var idEndereco=$('#id_edit').val();var idColaborador=$('#id_colaborador').val();var cep=$('#cep').val();var endereco=$('#endereco').val();var complemento=$('#complemento').val();var bairro=$('#bairro').val();var cidade=$('#cidade').val();var estado=estados_siglas[$('#estado').val()];if($('#acao').val()=='insert'){insereEndereco(idColaborador,endereco,complemento,bairro,cidade,estado,cep)}else{updateEndereco(idEndereco,idColaborador,endereco,complemento,bairro,cidade,estado,cep)}}else{$('#btn-submit').show();LoadingProgress.hide()}});$(document).ready(function(){if(getPageName()==='editar_endereco.html'){var idColaborador=getParam('id');if(idColaborador&&idColaborador){$("#cep").mask("99999-999");getEndereco(idColaborador)}
else{window.location.href='colaboradores.html'}}});var clientesCuradoria=['Disney','Rádio Disney'];var clientesMonitoria=['Chelsea','Marvel'];var saveFilmes=function saveFilmes(filmes){delFilmes();window.localStorage.setItem('filmes',JSON.stringify(filmes))}
var getFilmes=function getFilmes(){return JSON.parse(window.localStorage.getItem('filmes'))}
var delFilmes=function delFilmes(){localStorage.removeItem('filmes')}
var gerarListaFilmes=function gerarListaFilmes(quantidade){delFilmes();var nomes_aleatorios=["Felipe Silva","Gustavo Henrique","Gabriela","José Controle","Luís Alberto","Luís Fernando","Maria Oliveira","Jeferson Teixeira","Alberto Lussano","Illana Wolf","Ray Salazar","Roth Guthrie","Whoopi Tanner","Rowan Mclaughlin","Brenda Osborn","Lenore Snyder","Yvonne Mullen","Cassandra Baxter","Quail Glass","Ignatius Reed","Bradley Mason","Davis Ayala","Carolyn Knowles","Rafael Wheeler","Ginger Flowers","Flynn Middleton","Renee David","Alden Potts","Halla Bailey","Octavia Brock","Evangeline Peck","Stacy Barton","Tara Richardson","Buffy Sanchez","Ariel Guzman","Rashad Kidd","Grace Guthrie","Vielka Flynn","Linda Morin","Alec Jensen","Kelly Dillon","Elizabeth Thomas","Catherine Stone","Casey May","Lucas Bonner","Randall Dale","Clayton Avery","Rafael Schultz","Germaine Rosa","Raphael Walton","Brooke Hall","Flavia Mccarty","Bianca Bond","TaShya Frye","Jameson Perez","Macy Mcdonald","Sydnee Sanford","Blythe Hendricks","Shelly Macdonald","Lesley Mcmahon","Bethany Harvey","Myra Meadows","Norman Cherry","Fatima Juarez","Amaya Valdez","Neville Ray","Yoshi Burns","Gemma Watson","Lyle Dixon","Jennifer Pugh","Murphy Fisher","Autumn Marquez","Arden Langley","Rhea Stevens","Jarrod Sexton","Lacey Bass","Rachel Stuart","Aladdin Maddox","Tyler Jenkins","Jacob Mcintosh","Quamar Grant","Faith English","Carson Hatfield","Cecilia Velazquez","Quynn Mayer","Gannon Sutton","Driscoll Harrison","Malik Mcfadden","Jordan Pearson","Sloane Barrett","Aspen Duffy","Rhea Mckinney","Justina Merritt","Paki Downs","Scarlet Buckley","Eve Ayala","Ralph Forbes","Tanek Chaney","Aaron Deleon","Dean Callahan","Brady Herman","Risa Booker","Ronan Bruce","Haviva Massey","Leila Bowen","Ina Walters","Branden Kinney","Marvin Villarreal","Elizabeth Edwards"];var titulos_aleatorios=['Feliz Aniversário Ka!','Amor pra vida toda','Viagem para Madri 2016','Show do Paralamas','Minha princesa','Minha festa de 20','2 anos de namoro','Carnaval Brazil','Família na Disney','Os 3 mosqueteiros','Chá de cozinha Marcela','Passeio no parque','Melhores momentos 2015','Retrospectiva 2016 Paula','10 anos de casados','Niver Mauro','Viagem a Salvador','Pegando uma onda no feriadão','Tarde no boliche','Meu primeiro aninho','Só especiais','Amo muito tudo isso','Amigos de verdade nunca esquecemos','Saldades','Trilha na serra','Lua de mel Felipe e Beatriz','Sport lifestyle','Melhores amigas','Amizade','Miracle','Copa do Brasil','Viagem para Fortaleza','Boo!','Halloween'];var temas_aleatorios=['Disney','Rádio Disney','Chelsea','Marvel'];var idiomas_aleatorios=['en','pt','es'];var status_aleatorios=['Pendente'];var FilmesList=[];for(var i=1;i<=quantidade;i++){var ano=2016;var mes=12;var dia=Math.floor(Math.random()*31+1);var horaAleatoria=Math.floor(Math.random()*24+0);horaAleatoria=horaAleatoria<10?'0'+horaAleatoria:horaAleatoria;var minAleatorios=Math.floor(Math.random()*59+0);minAleatorios=minAleatorios<10?'0'+minAleatorios:minAleatorios;var segAleatorios=Math.floor(Math.random()*59+0);segAleatorios=segAleatorios<10?'0'+segAleatorios:segAleatorios;var data=new Date(ano,Number(mes-1),dia,horaAleatoria,minAleatorios,segAleatorios);dia=dia<10?'0'+dia:dia;FilmesList.push({idFilme:i,dataCriacao:dia+'/'+mes+'/'+ano+' '+horaAleatoria+':'+minAleatorios+':'+segAleatorios,data:data,descricaoFilme:titulos_aleatorios[Math.floor(Math.random()*(titulos_aleatorios.length)+0)],statusFilme:status_aleatorios[Math.floor(Math.random()*(status_aleatorios.length)+0)],temaFilme:temas_aleatorios[Math.floor(Math.random()*(temas_aleatorios.length)+0)],usuarioFilme:nomes_aleatorios[Math.floor(Math.random()*(nomes_aleatorios.length)+0)],usuarioIdioma:idiomas_aleatorios[Math.floor(Math.random()*(idiomas_aleatorios.length)+0)],comentarios:[]})}
saveFilmes(FilmesList)}
var getFilme=function getFilme(id){var filmeObj={};getFilmes().forEach(function(filme,index){if(filme.idFilme==id){filmeObj=filme}});return filmeObj}
var filterStatus=function filterStatus(status){return getFilmes().filter(function(filme){return filme.statusFilme==status})}
var filterCliente=function filterCliente(cliente){return getFilmes().filter(function(filme){return filme.temaFilme==cliente})}
var getNumPendentesCuradoria=function getNumPendentesCuradoria(){var qtdePendentes=0;if(getFilmes()){getFilmes().forEach(function(filme,index){if(!clientesMonitoria.some(function(cliente){return filme.temaFilme==cliente})){if(filme.statusFilme=='Pendente'){qtdePendentes++}}})}
return qtdePendentes}
var getNumPendentesMonitoria=function getNumPendentesMonitoria(){var qtdePendentes=0;if(getFilmes()){getFilmes().forEach(function(filme,index){if(!clientesCuradoria.some(function(cliente){return filme.temaFilme==cliente})){if(filme.statusFilme=='Pendente'){qtdePendentes++}}})}
return qtdePendentes}
var getIndexFilme=function getIndexFilme(id){var indexNum=null;getFilmes().forEach(function(filme,index){if(filme.idFilme==id){indexNum=index}});return indexNum}
var updateStatusFilme=function updateStatusFilme(id,status){var filmes=getFilmes();filmes.forEach(function(filme,index){if(filme.idFilme==id){filme.statusFilme=status}});saveFilmes(filmes)}
var addComentFilme=function addComentFilme(idFilme,comentario,colaborador){var filmes=getFilmes();var data=new Date();var dia=data.getDate()<10?'0'+data.getDate():data.getDate();var mes=data.getMonth()<10?'0'+data.getMonth():data.getMonth();var ano=data.getFullYear();data=dia+'/'+Number(mes+1)+'/'+ano;filmes.forEach(function(filme,index){if(filme.idFilme==idFilme){filme.comentarios.push({'comentario':comentario,'colaborador':colaborador,'data':data})}});saveFilmes(filmes)}
var clientesCuradoria=['Disney','Rádio Disney'];var clientesMonitoria=['Chelsea','Marvel'];var listarFilmesCuradoria=function listarFilmesCuradoria(filtroStatus,filtroCliente){$('#table').show();$('.sem-registros').hide();var filmes=[];if(filtroStatus!==''){var filmes=filterStatus(filtroStatus)}
if(filtroCliente!==''){var filmes=filterCliente(filtroCliente)}
if(filtroStatus===''&&filtroCliente===''){var filmes=getFilmes()}
if(filmes.length>0){var tbodyDOM=document.querySelector('#carrega-lista');tbodyDOM.innerHTML='';filmes.sort(function(a,b){a=new Date(a.data);b=new Date(b.data);return a>b?-1:a<b?1:0}).forEach(function(filme){if(!clientesMonitoria.some(function(cliente){return filme.temaFilme==cliente})){var trDOM=document.createElement('tr');trDOM.addEventListener('click',function(){window.location.href='filme_curadoria.html?id='+filme.idFilme});var td1DOM=document.createElement('td');var spanStatus=document.createElement('span');switch(filme.statusFilme){case 'Pendente':spanStatus.setAttribute('class','span_status pendente');spanStatus.innerHTML='Pendente';break;case 'Revisao':spanStatus.setAttribute('class','span_status revisao');spanStatus.innerHTML='Revisão';break;case 'Aprovado':spanStatus.setAttribute('class','span_status aprovado');spanStatus.innerHTML='Aprovado';break;case 'Reprovado':spanStatus.setAttribute('class','span_status reprovado');spanStatus.innerHTML='Reprovado';break;case 'Favorito':spanStatus.setAttribute('class','span_status favorito');spanStatus.innerHTML='Favorito';break}
td1DOM.appendChild(spanStatus);trDOM.appendChild(td1DOM);var td2DOM=document.createElement('td');td2DOM.innerHTML=filme.descricaoFilme;trDOM.appendChild(td2DOM);var td3DOM=document.createElement('td');td3DOM.innerHTML=filme.usuarioFilme;trDOM.appendChild(td3DOM);var td4DOM=document.createElement('td');td4DOM.setAttribute('class','visible_desktop');td4DOM.innerHTML=filme.temaFilme;trDOM.appendChild(td4DOM);var td5DOM=document.createElement('td');td5DOM.setAttribute('class','visible_desktop');td5DOM.innerHTML=filme.dataCriacao;trDOM.appendChild(td5DOM);tbodyDOM.appendChild(trDOM)}})}
else{$('#table').hide();$('.sem-registros').show()}}
var listarFilmesMonitoria=function listarFilmesMonitoria(filtroStatus,filtroCliente){$('#table').show();$('.sem-registros').hide();var filmes=[];if(filtroStatus!==''){var filmes=filterStatus(filtroStatus)}
if(filtroCliente!==''){var filmes=filterCliente(filtroCliente)}
if(filtroStatus===''&&filtroCliente===''){var filmes=getFilmes()}
if(filmes.length>0){var tbodyDOM=document.querySelector('#carrega-lista');tbodyDOM.innerHTML='';filmes.sort(function(a,b){a=new Date(a.data);b=new Date(b.data);return a>b?-1:a<b?1:0}).forEach(function(filme){if(!clientesCuradoria.some(function(cliente){return filme.temaFilme==cliente})){var trDOM=document.createElement('tr');trDOM.addEventListener('click',function(){window.location.href='filme_monitoria.html?id='+filme.idFilme});var td1DOM=document.createElement('td');var spanStatus=document.createElement('span');switch(filme.statusFilme){case 'Pendente':spanStatus.setAttribute('class','span_status pendente');spanStatus.innerHTML='Pendente';break;case 'Revisao':spanStatus.setAttribute('class','span_status revisao');spanStatus.innerHTML='Revisão';break;case 'Aprovado':spanStatus.setAttribute('class','span_status aprovado');spanStatus.innerHTML='Aprovado';break;case 'Reprovado':spanStatus.setAttribute('class','span_status reprovado');spanStatus.innerHTML='Reprovado';break;case 'Favorito':spanStatus.setAttribute('class','span_status favorito');spanStatus.innerHTML='Favorito';break}
td1DOM.appendChild(spanStatus);trDOM.appendChild(td1DOM);var td2DOM=document.createElement('td');td2DOM.innerHTML=filme.descricaoFilme;trDOM.appendChild(td2DOM);var td3DOM=document.createElement('td');td3DOM.innerHTML=filme.usuarioFilme;trDOM.appendChild(td3DOM);var td4DOM=document.createElement('td');td4DOM.setAttribute('class','visible_desktop');td4DOM.innerHTML=filme.temaFilme;trDOM.appendChild(td4DOM);var td5DOM=document.createElement('td');td5DOM.setAttribute('class','visible_desktop');td5DOM.innerHTML=filme.dataCriacao;trDOM.appendChild(td5DOM);tbodyDOM.appendChild(trDOM)}})}
else{$('#table').hide();$('.sem-registros').show()}}
$(document).ready(function(){if(getNumPendentesCuradoria()>0){$('#count-pendentes-curadoria-lt').text(getNumPendentesCuradoria())}
if(getNumPendentesMonitoria()>0){$('#count-pendentes-monitoria-lt').text(getNumPendentesMonitoria())}
if(getPageName()==='curadoria.html'){if(!getFilmes()){gerarListaFilmes(50)}
listarFilmesCuradoria('','');if(getNumPendentesCuradoria()>0){$('#count-pendentes-hd').text(getNumPendentesCuradoria())}
$('#btn-filtro-status-pendentes').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('Pendente','')});$('#btn-filtro-status-revisao').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('Revisao','')});$('#btn-filtro-status-aprovados').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('Aprovado','')});$('#btn-filtro-status-reprovados').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('Reprovado','')});$('#btn-filtro-status-favoritos').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('Favorito','')});$('#btn-filtro-cliente-disney').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('','Disney')});$('#btn-filtro-cliente-radio-disney').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesCuradoria('','Rádio Disney')})}});$(document).ready(function(){if(getPageName()==='filme_curadoria.html'){var id=getParam('id');if(id){var filmeCuradoria=getFilme(id);$('#id_filme').val(filmeCuradoria.idFilme);$('#titulo-filme').text(filmeCuradoria.descricaoFilme);$('#nome-user').text(filmeCuradoria.usuarioFilme);$('#tema-filme').text(filmeCuradoria.temaFilme);$('#data-filme').text(filmeCuradoria.dataCriacao);if(filmeCuradoria.statusFilme=='Revisao'&&filmeCuradoria.comentarios.length>0){var containerComents=document.querySelector('#load_comentarios');var sectionComents=document.createElement('section');sectionComents.setAttribute('class','detalhes-revisao');var tituloComents=document.createElement('h2');tituloComents.innerHTML='Comentários';sectionComents.appendChild(tituloComents);filmeCuradoria.comentarios.forEach(function(coment){var divComent=document.createElement('div');divComent.setAttribute('class','detalhe');var msgComent=document.createElement('p');msgComent.innerHTML=coment.comentario;divComent.appendChild(msgComent);var nomeDataComent=document.createElement('span');nomeDataComent.innerHTML=coment.colaborador+' em '+coment.data;divComent.appendChild(nomeDataComent);sectionComents.appendChild(divComent)});containerComents.appendChild(sectionComents)}
$('#btn-aprovar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();updateStatusFilme(idFilmeEdit,'Aprovado');setMessageRetorno('Filme aprovado com sucesso');window.location.href='curadoria.html'});$('#btn-favoritar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();updateStatusFilme(idFilmeEdit,'Favorito');setMessageRetorno('Filme aprovado com sucesso');window.location.href='curadoria.html'});$('#btn-revisao-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();window.location.href='curadoria_revisao.html?id='+idFilmeEdit});$('#btn-reprovar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();window.location.href='curadoria_reprovacao.html?id='+idFilmeEdit})}
else{window.location.href='curadoria.html'}}});$(document).ready(function(){if(getPageName()==='curadoria_revisao.html'){var id=getParam('id');if(id){var filmeRevisao=getFilme(id);$('#id_filme').val(filmeRevisao.idFilme);$('#titulo-filme').text(filmeRevisao.descricaoFilme);$('#btn-back').attr('href','filme_curadoria.html?id='+filmeRevisao.idFilme);$("#form-revisao-curadoria").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();if(validaFormulario()){var comentario=$('#comentario').val();addComentFilme(filmeRevisao.idFilme,comentario,getUserNome());updateStatusFilme(filmeRevisao.idFilme,'Revisao');setMessageRetorno('Filme marcado para revisão');window.location.href='curadoria.html'}else{$('#btn-submit').show()}})}
else{window.location.href='curadoria.html'}}});$(document).ready(function(){if(getPageName()==='curadoria_reprovacao.html'){var id=getParam('id');if(id){var filmeRevisao=getFilme(id);switch(filmeRevisao.usuarioIdioma){case 'pt':$('#idioma-user').text('Português');break;case 'en':$('#idioma-user').text('Inglês');break;case 'es':$('#idioma-user').text('Espanhol');break}
$.ajax({url:'http://localhost/Prj_StayFilm/respostas',type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(itens){if(itens.length>0){var select=document.querySelector('#carrega_respostas');itens.forEach(function(item){var liOpt=document.createElement('li');liOpt.setAttribute('class','mdl-menu__item');liOpt.innerHTML=item.tituloResposta;liOpt.addEventListener('click',function(e){switch(filmeRevisao.usuarioIdioma){case 'pt':$('#resposta').val(item.respostaBRA).parent().addClass('is-dirty');break;case 'en':$('#resposta').val(item.respostaUSA).parent().addClass('is-dirty');break;case 'es':$('#resposta').val(item.respostaESP).parent().addClass('is-dirty');break}});select.appendChild(liOpt);getmdlSelect.init('.getmdl-select')})}}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)});$('#id_filme').val(filmeRevisao.idFilme);$('#titulo-filme').text(filmeRevisao.descricaoFilme);$('#btn-back').attr('href','filme_curadoria.html?id='+filmeRevisao.idFilme);$("#form-reprovacao-curadoria").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();if(validaFormulario()){var motivo=$('#motivo').val();var resposta=$('#resposta').val();updateStatusFilme(filmeRevisao.idFilme,'Reprovado');setMessageRetorno('Filme reprovado com sucesso');window.location.href='curadoria.html'}else{$('#btn-submit').show()}})}
else{window.location.href='curadoria.html'}}});$(document).ready(function(){if(getPageName()==='monitoria.html'){if(!getFilmes()){gerarListaFilmes(50)}
listarFilmesMonitoria('','');if(getNumPendentesMonitoria()>0){$('#count-pendentes-hd').text(getNumPendentesMonitoria())}
$('#btn-filtro-status-pendentes').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('Pendente','')});$('#btn-filtro-status-revisao').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('Revisao','')});$('#btn-filtro-status-aprovados').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('Aprovado','')});$('#btn-filtro-status-reprovados').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('Reprovado','')});$('#btn-filtro-status-favoritos').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('Favorito','')});$('#btn-filtro-cliente-chelsea').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('','Chelsea')});$('#btn-filtro-cliente-marvel').on('click',function(e){e.preventDefault();e.stopPropagation();listarFilmesMonitoria('','Marvel')})}});$(document).ready(function(){if(getPageName()==='filme_monitoria.html'){var id=getParam('id');if(id){var filmeMonitoria=getFilme(id);$('#id_filme').val(filmeMonitoria.idFilme);$('#titulo-filme').text(filmeMonitoria.descricaoFilme);$('#nome-user').text(filmeMonitoria.usuarioFilme);$('#tema-filme').text(filmeMonitoria.temaFilme);$('#data-filme').text(filmeMonitoria.dataCriacao);if(filmeMonitoria.statusFilme=='Revisao'&&filmeMonitoria.comentarios.length>0){var containerComents=document.querySelector('#load_comentarios');var sectionComents=document.createElement('section');sectionComents.setAttribute('class','detalhes-revisao');var tituloComents=document.createElement('h2');tituloComents.innerHTML='Comentários';sectionComents.appendChild(tituloComents);filmeMonitoria.comentarios.forEach(function(coment){var divComent=document.createElement('div');divComent.setAttribute('class','detalhe');var msgComent=document.createElement('p');msgComent.innerHTML=coment.comentario;divComent.appendChild(msgComent);var nomeDataComent=document.createElement('span');nomeDataComent.innerHTML=coment.colaborador+' em '+coment.data;divComent.appendChild(nomeDataComent);sectionComents.appendChild(divComent)});containerComents.appendChild(sectionComents)}
$('#btn-aprovar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();updateStatusFilme(idFilmeEdit,'Aprovado');setMessageRetorno('Filme aprovado com sucesso');window.location.href='monitoria.html'});$('#btn-favoritar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();updateStatusFilme(idFilmeEdit,'Favorito');setMessageRetorno('Filme aprovado com sucesso');window.location.href='monitoria.html'});$('#btn-revisao-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();window.location.href='monitoria_revisao.html?id='+idFilmeEdit});$('#btn-reprovar-filme').on('click',function(e){e.preventDefault();e.stopPropagation();var idFilmeEdit=$('#id_filme').val();window.location.href='monitoria_reprovacao.html?id='+idFilmeEdit})}
else{window.location.href='monitoria.html'}}});$(document).ready(function(){if(getPageName()==='monitoria_revisao.html'){var id=getParam('id');if(id){var filmeRevisao=getFilme(id);$('#id_filme').val(filmeRevisao.idFilme);$('#titulo-filme').text(filmeRevisao.descricaoFilme);$('#btn-back').attr('href','filme_monitoria.html?id='+filmeRevisao.idFilme);$("#form-revisao-monitoria").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();if(validaFormulario()){var comentario=$('#comentario').val();addComentFilme(filmeRevisao.idFilme,comentario,getUserNome());updateStatusFilme(filmeRevisao.idFilme,'Revisao');setMessageRetorno('Filme marcado para revisão');window.location.href='monitoria.html'}else{$('#btn-submit').show()}})}
else{window.location.href='monitoria.html'}}});$(document).ready(function(){if(getPageName()==='monitoria_reprovacao.html'){var id=getParam('id');if(id){var filmeRevisao=getFilme(id);switch(filmeRevisao.usuarioIdioma){case 'pt':$('#idioma-user').text('Português');break;case 'en':$('#idioma-user').text('Inglês');break;case 'es':$('#idioma-user').text('Espanhol');break}
$.ajax({url:'http://localhost/Prj_StayFilm/respostas',type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(itens){if(itens.length>0){var select=document.querySelector('#carrega_respostas');itens.forEach(function(item){var liOpt=document.createElement('li');liOpt.setAttribute('class','mdl-menu__item');liOpt.innerHTML=item.tituloResposta;liOpt.addEventListener('click',function(e){switch(filmeRevisao.usuarioIdioma){case 'pt':$('#resposta').val(item.respostaBRA).parent().addClass('is-dirty');break;case 'en':$('#resposta').val(item.respostaUSA).parent().addClass('is-dirty');break;case 'es':$('#resposta').val(item.respostaESP).parent().addClass('is-dirty');break}});select.appendChild(liOpt);getmdlSelect.init('.getmdl-select')})}}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)});$('#id_filme').val(filmeRevisao.idFilme);$('#titulo-filme').text(filmeRevisao.descricaoFilme);$('#btn-back').attr('href','filme_monitoria.html?id='+filmeRevisao.idFilme);$("#form-reprovacao-monitoria").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();if(validaFormulario()){var motivo=$('#motivo').val();var resposta=$('#resposta').val();updateStatusFilme(filmeRevisao.idFilme,'Reprovado');setMessageRetorno('Filme reprovado com sucesso');window.location.href='monitoria.html'}else{$('#btn-submit').show()}})}
else{window.location.href='monitoria.html'}}});var nomeMeses=['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];var nomeDias=['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'];var setMes=function setMes(mes){if(mes>11){window.localStorage.setItem('mes',0);setAno(getAno()+1)}else if(mes<0){window.localStorage.setItem('mes',11);setAno(getAno()-1)}else{window.localStorage.setItem('mes',mes)}}
var getMes=function getMes(){var mes=window.localStorage.getItem('mes');return Number(mes)}
var setAno=function setAno(ano){window.localStorage.setItem('ano',ano)}
var getAno=function getAno(){var ano=window.localStorage.getItem('ano');return Number(ano)}
var obterDiasDoMes=function obterDiasDoMes(mes,ano){var data=new Date(ano,mes,1);var dias=[];while(data.getMonth()===mes){dias.push(new Date(data));data.setDate(data.getDate()+1)}
return dias}
var preecheSemanas=function preecheSemanas(dias){var dias=dias;var primeiroDia=dias[0];var ultimoDia=dias[dias.length-1];var primeiroDiaNumSemana=primeiroDia.getDay();var ultimoDiaNumSemana=ultimoDia.getDay();var qtdeDiasMesAnterior=primeiroDiaNumSemana;if(primeiroDia.getMonth()==0){var diasMesAnterior=obterDiasDoMes(11,(primeiroDia.getFullYear()-1))}else{var diasMesAnterior=obterDiasDoMes((primeiroDia.getMonth()-1),primeiroDia.getFullYear())}
var ultimoDiaMesAnterior=diasMesAnterior[diasMesAnterior.length-1];if(primeiroDiaNumSemana!=0){for(var i=0;i<qtdeDiasMesAnterior;i++){var data_anterior=diasMesAnterior[diasMesAnterior.length-(i+1)];dias.unshift(data_anterior)}}
var qtdeDiasMesPosterior=7-(ultimoDiaNumSemana+1);if(ultimoDia.getMonth()==11){var diasMesPostetior=obterDiasDoMes(0,(primeiroDia.getFullYear()+1))}else{var diasMesPostetior=obterDiasDoMes((primeiroDia.getMonth()+1),primeiroDia.getFullYear())}
if(ultimoDiaNumSemana!=6){for(var i=0;i<qtdeDiasMesPosterior;i++){var data_posterior=diasMesPostetior[i];dias.push(data_posterior)}}
return dias}
var quebraArray=function quebraArray(array,numPartes){var matriz=[];var qtdeArrays=array.length/numPartes;var itensTransferidos=0;var partesTransferidas=numPartes;for(var i=0;i<qtdeArrays;i++){var array_parte=[];for(var x=itensTransferidos;x<partesTransferidas;x++){if(!array[x]){continue}
array_parte.push(array[x])}
itensTransferidos+=numPartes;partesTransferidas+=numPartes;matriz.push(array_parte)}
return matriz}
var populaCalendario=function populaCalendario(mes,ano){$.ajax({url:'http://localhost/Prj_StayFilm/listarEscalaMontada/'+getUserId()+'?mes='+(mes+1)+'&ano='+ano,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(escalas){limparCalendario();var mesCompleto=quebraArray(preecheSemanas(obterDiasDoMes(mes,ano)),7);var calendarioTitulo=document.querySelector('#calendar-title');calendarioTitulo.innerHTML=nomeMeses[mes]+' '+ano;var calendarioDOM=document.querySelector('#calendar-load');mesCompleto.forEach(function(semana){var semanaDOM=document.createElement('ul');semanaDOM.setAttribute('class','days');semana.forEach(function(dia){var diaDOM=document.createElement('li');var dataDOM=document.createElement('div');dataDOM.setAttribute('class','date');dataDOM.innerHTML=dia.getDate();diaDOM.appendChild(dataDOM);var dataDescDOM=document.createElement('label');dataDescDOM.setAttribute('class','desc-day');dataDescDOM.innerHTML=nomeDias[dia.getDay()];diaDOM.appendChild(dataDescDOM);if(dia.getMonth()===mes){escalas.forEach(function(escala,index){if(escala.dia==dia.getDate()){if(escala.bloqueado.length>0){escala.bloqueado.forEach(function(horario){var horarioDOM=document.createElement('div');horarioDOM.setAttribute('class','horario-block');horarioDOM.innerHTML=horario;diaDOM.appendChild(horarioDOM)})}
if(escala.escalados.length>0){escala.bloqueado.forEach(function(horario){var horarioDOM=document.createElement('div');horarioDOM.setAttribute('class','horario-escal');horarioDOM.innerHTML=horario;diaDOM.appendChild(horarioDOM)})}}});diaDOM.setAttribute('class','day');var dataAttr=dia.getFullYear()+'-'+(dia.getMonth()+1)+'-'+dia.getDate();diaDOM.setAttribute('data-data',dataAttr)}else{diaDOM.setAttribute('class','day other-month')}
semanaDOM.appendChild(diaDOM)});calendarioDOM.appendChild(semanaDOM)})}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
var limparCalendario=function limparCalendario(){var calendarioDOM=document.querySelector('#calendar-load');calendarioDOM.innerHTML=''}
var soma1Data=function soma1Data(data){var dataSplit=data.split('-');return dataSplit[0]+'-'+dataSplit[1]+'-'+(Number(dataSplit[2])+1)}
var AddHorario=function AddHorario(data,horaInicio,horaFim){var dados={data:soma1Data(data),horaInicio:horaInicio,horaFim:horaFim}
$.ajax({url:'http://localhost/Prj_StayFilm/escalabloqueioEspecifico/'+getUserId(),type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){console.log('escala inserida com sucesso')}).fail(function(response){console.log('erro ao inserir escala')});window.location.reload()}
var strToDate=function strToDate(string){var dataSplit=string.split('/');var diaSplit=dataSplit[0];var mesSplit=dataSplit[1];mesSplit--;var anoSplit=dataSplit[2];var dataObj=new Date(anoSplit,mesSplit,diaSplit);return dataObj}
var dataExtenso=function dataExtenso(data){var dataObj=strToDate(data);return nomeDias[dataObj.getDay()]+', '+dataObj.getDate()+' de '+nomeMeses[dataObj.getMonth()]+' de '+dataObj.getFullYear()}
$(document).ready(function(){if(getPageName()==='minha_escala.html'){var dataAtual=new Date();setMes(dataAtual.getMonth());setAno(dataAtual.getFullYear());populaCalendario(getMes(),getAno());var btnAnt=document.querySelector('#btn-ant');btnAnt.addEventListener('click',function(){setMes(getMes()-1);populaCalendario(getMes(),getAno())});var btnProx=document.querySelector('#btn-prox');btnProx.addEventListener('click',function(){setMes(getMes()+1);populaCalendario(getMes(),getAno())});var calendarioDOM=document.querySelector('#calendar-load');var calendarioFocus=function calendarioFocus(){calendarioDOM.scrollIntoView()}
calendarioDOM.addEventListener('click',function(clickDay){var alvoClick=clickDay.target;if(alvoClick.nodeName==='LI'||alvoClick.nodeName==='DIV'){var dataClicadaDOM;if(alvoClick.nodeName==='LI'){dataClicadaDOM=clickDay.target}else if(alvoClick.nodeName==='DIV'){dataClicadaDOM=clickDay.target.parentElement}
if(dataClicadaDOM.className==='day'){var dataClicada=dataClicadaDOM.dataset.data;fechaCaixa();horarioDescDOM.innerHTML=dataExtenso(formatDataBR(dataClicada));InputHorarioData.value=dataClicada;abreCaixa()}}else{clickDay.stopPropagation();clickDay.preventDefault()}});var caixaDOM=document.querySelector('.card-horario');var fechaCaixa=function fechaCaixa(){caixaDOM.style.display='none';calendarioFocus()}
var abreCaixa=function abreCaixa(){caixaDOM.style.display='-webkit-flex';caixaDOM.style.display='-ms-flexbox';caixaDOM.style.display='flex';caixaFocus()}
var caixaFocus=function caixaFocus(){caixaDOM.scrollIntoView()}
var btnClose=document.querySelector('#box-close');btnClose.addEventListener('click',function(){fechaCaixa()});$("#horario").mask("99h às 99h");$('.mdl-textfield__input').on('change',function(){if($(this).val()){$(this).parent().addClass('is-dirty')}});var horarioDescDOM=document.querySelector('#horario-desc');var InputHorarioData=document.querySelector('#horario-data');var InputHorario=document.querySelector('#horario');var btnAdd=document.querySelector('#btn-add');btnAdd.addEventListener('click',function(){horarios=InputHorario.value.replace(/h|\s*/ig,'').split('às');var hData=InputHorarioData.value;var hInicio=horarios[0].replace(/^0+/,'');var hFinal=horarios[1].replace(/^0+/,'');AddHorario(hData,hInicio,hFinal);fechaCaixa()})}});var populaCalendarioGerenciamento=function populaCalendarioGerenciamento(mes,ano){$.ajax({url:'http://localhost/Prj_StayFilm/diasConcluidosMes/?mes='+(mes+1)+'&ano='+ano,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){var diasConcluidos=[];$.each(response,function(i,el){if($.inArray(el,diasConcluidos)===-1)diasConcluidos.push(el)});limparCalendario();var mesCompleto=quebraArray(preecheSemanas(obterDiasDoMes(mes,ano)),7);var calendarioTitulo=document.querySelector('#calendar-title');calendarioTitulo.innerHTML=nomeMeses[mes]+' '+ano;var calendarioDOM=document.querySelector('#calendar-load');mesCompleto.forEach(function(semana){var semanaDOM=document.createElement('ul');semanaDOM.setAttribute('class','days');semana.forEach(function(dia){var diaDOM=document.createElement('li');var dataDOM=document.createElement('div');dataDOM.setAttribute('class','date');dataDOM.innerHTML=dia.getDate();diaDOM.appendChild(dataDOM);var dataDescDOM=document.createElement('label');dataDescDOM.setAttribute('class','desc-day');dataDescDOM.innerHTML=nomeDias[dia.getDay()];diaDOM.appendChild(dataDescDOM);if(dia.getMonth()===mes){if(diasConcluidos.some(function(diaC){return diaC==dia.getDate()})){diaDOM.style.background='#8BC34A'}
diaDOM.setAttribute('class','day');var dataAttr=dia.getFullYear()+'-'+(dia.getMonth()+1)+'-'+dia.getDate();diaDOM.setAttribute('data-data',dataAttr)}else{diaDOM.setAttribute('class','day other-month')}
semanaDOM.appendChild(diaDOM)});calendarioDOM.appendChild(semanaDOM)})}).fail(function(response){console.log(response);snackMessage('#snackbar','Não foi possível realizar essa operação',3000)})}
var AddEscala=function AddEscala(dataEscala,horaEscalaInicio,horaEscalaFim,colaboradorId){var dados={dataEscala:soma1Data(dataEscala),horaEscalaInicio:horaEscalaInicio,horaEscalaFim:horaEscalaFim,colaboradorId:colaboradorId}
$.ajax({url:'http://localhost/Prj_StayFilm/escala/'+getUserId(),type:'POST',dataType:'json',contentType:'application/json;charset=utf-8',data:JSON.stringify(dados),headers:{'Authorization':getToken()}}).done(function(response){console.log('ok');setMessageRetorno('Colaborador escalado com sucesso');window.location.reload()}).fail(function(response){console.log(response)})}
$(document).ready(function(){if(getPageName()==='escala.html'){var dataAtual=new Date();setMes(dataAtual.getMonth());setAno(dataAtual.getFullYear());populaCalendarioGerenciamento(getMes(),getAno());var btnAnt=document.querySelector('#btn-ant');btnAnt.addEventListener('click',function(){setMes(getMes()-1);populaCalendarioGerenciamento(getMes(),getAno())});var btnProx=document.querySelector('#btn-prox');btnProx.addEventListener('click',function(){setMes(getMes()+1);populaCalendarioGerenciamento(getMes(),getAno())});var calendarioDOM=document.querySelector('#calendar-load');var calendarioFocus=function calendarioFocus(){calendarioDOM.scrollIntoView()}
calendarioDOM.addEventListener('click',function(clickDay){var alvoClick=clickDay.target;if(alvoClick.nodeName==='LI'||alvoClick.nodeName==='DIV'){var dataClicadaDOM;if(alvoClick.nodeName==='LI'){dataClicadaDOM=clickDay.target}else if(alvoClick.nodeName==='DIV'){dataClicadaDOM=clickDay.target.parentElement}
if(dataClicadaDOM.className==='day'){var dataClicada=dataClicadaDOM.dataset.data;$('#horario-desc').text(dataExtenso(formatDataBR(dataClicada)));$('#data-escala').val(dataClicada);$('#escala-container').show();$('#escala-container')[0].scrollIntoView();$.ajax({url:'http://localhost/Prj_StayFilm/private/bloqueadosDia/'+dataClicada,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){var listaBloq=document.querySelector('#lista-bloqueados');listaBloq.innerHTML='';response.forEach(function(colBloq){var liBloq=document.createElement('li');liBloq.setAttribute('class','mdl-list__item');var spanNomeBloq=document.createElement('span');spanNomeBloq.setAttribute('class','mdl-list__item-primary-content');var iconBloq=document.createElement('i');iconBloq.setAttribute('class','material-icons  mdl-list__item-avatar');iconBloq.innerHTML='person';spanNomeBloq.appendChild(iconBloq);var spanNomeBloq2=document.createElement('span');spanNomeBloq2.innerHTML=colBloq.nome;spanNomeBloq.appendChild(spanNomeBloq2);liBloq.appendChild(spanNomeBloq);var ulHorariosBloq=document.createElement('ul');ulHorariosBloq.setAttribute('class','list-horarios');var liHorariosBloq=document.createElement('li');liHorariosBloq.innerHTML=colBloq.horario[0]+'h - '+colBloq.horario[colBloq.horario.length-1]+'h';ulHorariosBloq.appendChild(liHorariosBloq);liBloq.appendChild(ulHorariosBloq);listaBloq.appendChild(liBloq)})}).fail(function(response){console.log(response)});$.ajax({url:'http://localhost/Prj_StayFilm/private/escaladosDia/'+dataClicada,type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){var listaEsc=document.querySelector('#carrega-escalados');listaEsc.innerHTML='';response.forEach(function(colEsc){var liEsc=document.createElement('li');liEsc.setAttribute('class','mdl-list__item');var spanNomeEsc=document.createElement('span');spanNomeEsc.setAttribute('class','mdl-list__item-primary-content');var iconEsc=document.createElement('i');iconEsc.setAttribute('class','material-icons  mdl-list__item-avatar');iconEsc.innerHTML='person';spanNomeEsc.appendChild(iconEsc);var spanNomeEsc2=document.createElement('span');spanNomeEsc2.innerHTML=colEsc.nome;spanNomeEsc.appendChild(spanNomeEsc2);liEsc.appendChild(spanNomeEsc);var ulHorariosEsc=document.createElement('ul');ulHorariosEsc.setAttribute('class','list-horarios');colEsc.horarios.forEach(function(horario){var liHorariosEsc=document.createElement('li');liHorariosEsc.innerHTML=horario.horarioInicio+'h - '+horario.horarioFim+'h';ulHorariosEsc.appendChild(liHorariosEsc)});liEsc.appendChild(ulHorariosEsc);listaEsc.appendChild(liEsc)})}).fail(function(response){console.log(response)});$.ajax({url:'http://localhost/Prj_StayFilm/listarColaboradores',type:'GET',dataType:'json',contentType:'application/json;charset=utf-8',headers:{'Authorization':getToken()}}).done(function(response){var selectColaboradores=document.querySelector('#carrega-colaboradores');selectColaboradores.innerHTML='';response.forEach(function(colaborador){var colItem=document.createElement('li');colItem.setAttribute('class','mdl-menu__item');colItem.setAttribute('data-id',colaborador.idColaborador);colItem.innerHTML=colaborador.nome;colItem.addEventListener('click',function(e){$('#id-colaborador').val(colaborador.idColaborador);e.preventDefault();e.stopPropagation()});selectColaboradores.appendChild(colItem)});getmdlSelect.init('.getmdl-select');componentHandler.upgradeDom()}).fail(function(response){console.log(response)})}}else{clickDay.stopPropagation();clickDay.preventDefault()}})}});$("#escala-add-colaborador").on('submit',function(e){e.preventDefault();$('#btn-submit').hide();$('#msg-erro-escala').text('');if(validaFormulario()){var horaInicial=Number($('#horario_inicial').val().replace(':00',''));var horaFinal=Number($('#horario_final').val().replace(':00',''));if(horaInicial<horaFinal){var dataEscala=$('#data-escala').val();var colaboradorId=$('#id-colaborador').val();AddEscala(dataEscala,horaInicial,horaFinal,colaboradorId)}else{$('#msg-erro-escala').text('Selecione um horário final maior que o inicial');$('#btn-submit').show()}}else{$('#btn-submit').show()}})